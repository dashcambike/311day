<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Add a line to a map using a GeoJSON source</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js"></script>
<style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    .mapboxgl-popup {
        max-width: 400px;
        font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    }
</style>
</head>
<body>
<div id="map"></div>
<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoiZGFzaGNhbWJpa2UiLCJhIjoiY2t5b21zYXRiMDFteTJuamp6OGsxYW1pMCJ9.WdwRJIoAVp4axNpMfYW2zQ';
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v12',
        center: [-77.49, 39.74],
        zoom: 4
    });
    const data = [
        {
            host: "Test Organization",
            url: "https://google.com",
            type: "Bike Ride",
            location: [40.45219457697122, -79.98373117193064],
            time: "10am",
            distance: "About 2 miles",
            description: "We will start the event at St. Stanislaus Kostka Church, riding along bike lanes for almost the entire route. From the meeting location, we will head to The Point, reporting any cars parked in the bike lane to 311 using the Dashcam for your Bike app. After reaching the point, we will head back, ending at De Fer in the Strip for a coffee.",
        },
        {
            host: "Test Organization",
            url: "https://google.com",
            type: "Walk",
            location: [41.41219457697122, -78.58373117193064],
            time: "10am",
            distance: "About 2 miles",
            description: "We will start the event at St. Stanislaus Kostka Church, riding along bike lanes for almost the entire route. From the meeting location, we will head to The Point, reporting any cars parked in the bike lane to 311 using the Dashcam for your Bike app. After reaching the point, we will head back, ending at De Fer in the Strip for a coffee.",
        }
    ];
    const featureCollection = data.map(d =>
        ({
            type: 'Feature',
            properties: {
                description: `<strong>Host:</strong> <a href="${d.url}">${d.host}</a><br/>` +
                             `<strong>Time:</strong> ${d.time}<br/>` +
                             `<strong>Distance:</strong> ${d.distance}<br/>` +
                             `<p>${d.description}</p>`,
                icon: d.type == "Bike Ride" ? "bicycle" : "pitch",
            },
            geometry: {
                type: 'Point',
                coordinates: [d.location[1], d.location[0]]
            }
        })
    );
 
    map.on('load', () => {
        map.addSource('places', {
            'type': 'geojson',
            'data': {
                'type': 'FeatureCollection',
                'features': featureCollection
            }
        });
        // Add a layer showing the places.
        map.addLayer({
            'id': 'places',
            'type': 'symbol',
            'source': 'places',
            'layout': {
                'icon-image': ['get', 'icon'],
                'icon-size': 2.0,
                'icon-allow-overlap': true
            }
        });
         
        // When a click event occurs on a feature in the places layer, open a popup at the
        // location of the feature, with description HTML from its properties.
        map.on('click', 'places', (e) => {
            // Copy coordinates array.
            const coordinates = e.features[0].geometry.coordinates.slice();
            const description = e.features[0].properties.description;
             
            // Ensure that if the map is zoomed out such that multiple
            // copies of the feature are visible, the popup appears
            // over the copy being pointed to.
            while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
            }
             
            new mapboxgl.Popup()
            .setLngLat(coordinates)
            .setHTML(description)
            .addTo(map);
        });
         
        // Change the cursor to a pointer when the mouse is over the places layer.
        map.on('mouseenter', 'places', () => {
            map.getCanvas().style.cursor = 'pointer';
        });
         
        // Change it back to a pointer when it leaves.
        map.on('mouseleave', 'places', () => {
            map.getCanvas().style.cursor = '';
        });
    });
</script>
 
</body>
</html>
